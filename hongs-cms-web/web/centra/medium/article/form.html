<h2>{DO}文章</h2>
<div id="medium-article-form"
     data-module="hsForm"
     data-load-url="('manage/medium/article/retrieve.act?md='+(H$('&id',this)?'1':'0'))"
     data-save-url="('manage/medium/article/'+(H$('&id',this)?'update.act':'create.act'))">
    <form action="" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="id"/>
        <input type="hidden" name="sections.0.sect_id" data-pn="sect_id"/>
        <input type="hidden" name="type" value="default"/>
        <input type="hidden" name="temp" value="default"/>
        <input type="hidden" name="kind" value="html"/>
        <input type="hidden" name="stave" value="0"/>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label class="control-label">名称</label>
                    <input type="text" name="name" class="form-control" required="required" data-unique="manage/member/user/unique.act?id=${id}"/>
                </div>
                <div class="form-group">
                    <label class="control-label">干净模式</label>
                    <label>
                        <input type="checkbox" name="staves." value="1"/>
                    </label>
                </div>
                <div class="form-group">
                    <label class="control-label">禁止评论</label>
                    <label>
                        <input type="checkbox" name="staves." value="2"/>
                    </label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group dont-close">
                    <label class="control-label">题图</label>
                    <input type="file" name="snap" class="form-control" accept="image/*" data-toggle="fileinput"/>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label class="control-label">标签</label>
                    <input type="text" name="word" class="form-control"/>
                </div>
                <div class="form-group">
                    <label class="control-label">简介</label>
                    <input type="text" name="note" class="form-control"/>
                </div>
                <div class="form-group">
                    <label class="control-label">内容</label>
                    <textarea name="html" id="article-html" style="width:100%;height:400px;"></textarea>
                    <textarea name="data" id="article-data" style="display:none;"></textarea>
                </div>
            </div>
        </div>
        <div>
            <button type="submit" class="ensure btn btn-primary">提交</button>
            <button type="button" class="cancel btn btn-link"   >取消</button>
        </div>
    </form>
</div>
<script type="text/javascript">
    (function($) {
        var context = $( "#medium-article-form" );
        var loadbox = context.closest(".loadbox");

        context.on("loadBack", function(evt, rst) {
            if (!rst.info || $.isEmptyObject(rst.info)) {
                return;
            }
            var stave  = parseInt(rst.info.stave);
            var staves = [];
            if (1 == (1 & stave)) {
                staves.push(1);
            }
            if (2 == (2 & stave)) {
                staves.push(2);
            }
            rst.info.staves = staves;
        });
        context.on("loadOver", function(evt, rst) {
            self.AE = UE.getEditor("article-html");
        });
        loadbox.on("hsClose" , function() {
            AE.destroy();
        });
        
        context.find("[name='staves.']").on("change", function() {
            var sta = context.find("[name='staves.']:checked");
            var stv = context.find("[name='stave']");
            var stn = 0;
            sta.each(function() {
                stn += parseInt($(this).val());
            });
            stv.val(stn);
        });
    })(jQuery);
</script>